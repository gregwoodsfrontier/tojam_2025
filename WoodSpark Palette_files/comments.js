(()=>{var n,o,c,i,m,l,a,s=document.querySelector(".comment-form");function u(){var e=1<m.innerText.length,t=0<m.querySelectorAll("img.inline-image").length,n=0<m.querySelectorAll("img.emoji").length;c.disabled=!(e||t||n)}s&&!0!==s.enabled&&(s.enabled=!0,s.dataset.login?s.addEventListener("click",e=>{document.querySelector(".popup.sign-up").show(e),e.preventDefault()}):(n=document.querySelector(".comment-form .submit-bar .reply-bar div:first-child"),o=document.querySelector(".comment-form .submit-bar .reply-bar .clear-reply"),c=document.querySelector(".comment-form .button-submit"),i=document.querySelector(".comment-form .editor .export"),m=document.querySelector(".comment-form .editor .content-area"),l=document.querySelector(".comment-list"),a=document.querySelector('.comment-form input[name="reply-id"]'),c.addEventListener("click",e=>{l.querySelectorAll(".comment-container.new").forEach(e=>e.classList.remove("new"));var t={comment:i.value},n=3<a.value.length,r=(n&&(t.reply=a.value),c.disabled=!0,"/comments/"+s.dataset.submission);ajax(r,t,e=>{if(e.success){if(n){for(var t=document.querySelector("#comment-"+a.value).closest(".comment-container");t.nextElementSibling&&t.nextElementSibling.classList.contains("child-comment");)t=t.nextElementSibling;t.insertAdjacentHTML("afterend",e.html),location.hash="#comment-"+a.value}else l.insertAdjacentHTML("afterbegin",e.html);m.innerHTML="<div></div>",i.value="<div></div>",o.click(),toast.show("Comment posted","check"),setTimeout(()=>{l.querySelectorAll(".comment-container.animate").forEach(e=>e.classList.remove("animate"))},1e3)}else e.error&&toast.show(e.error,"x");u()}),e.preventDefault()}),l.addEventListener("click",e=>{var t;e.target.classList.contains("reply-button")&&(t=(e=e.target.closest(".comment-container")).dataset.id,a.value=t,t=e.dataset.author,e=e.querySelector(".comment-data .comment-html").innerText,n.innerHTML="<span>Replying to @"+t+":</span> "+e,setTimeout(function(){m.focus()},0),document.querySelector(".comment-form .submit-bar .reply-bar").style.visibility="visible")}),o.addEventListener("click",e=>{document.querySelector(".comment-form .submit-bar .reply-bar").style.visibility="hidden",n.innerHTML="",a.value=""}),m.addEventListener("keyup",u),m.addEventListener("paste",u),m.addEventListener("change",u),m.addEventListener("export",u)))})();